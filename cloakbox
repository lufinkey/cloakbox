#!/bin/bash

base_dir=$(dirname "${BASH_SOURCE[0]}")
prog_name=cloakbox

if [ "$1" == "setup" ]
then
	cd "$base_dir"

	read -p "enter your PIA username: " pia_user
	read -s -p "enter your PIA password: " pia_pass
	echo ""

	mkdir -p "shared"
	mkdir -p "shared/.$prog_name"
	mkdir -p "shared/downloads"
	rm -rf "shared/.$prog_name/setup_done"
	vagrant plugin install vagrant-vbguest
	mkdir -p "shared/.$prog_name/tmp"
	echo "$pia_user" > "shared/.$prog_name/tmp/pia_credentials"
	echo "$pia_pass" >> "shared/.$prog_name/tmp/pia_credentials"
	vagrant up --provision
	vagrant halt
	rm -rf "shared/.$prog_name/tmp/pia_credentials"
elif [ "$1" == "start" ]
then
	cd "$base_dir"
	if [ ! -f "shared/.$prog_name/setup_done" ]
	then
		"$0" setup
	fi
	vagrant up
elif [ "$1" == "stop" ]
then
	cd "$base_dir"
	vagrant halt
elif [ "$1" == "clean" ]
then
	cd "$base_dir"
	# TODO maybe prompt before cleaning? I dunno
	vagrant destroy -f
	rm -rf shared
	rm -f *.log
	# TODO add a flag for also deleting the .vagrant folder
fi

